<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDAH CMS - Content Management</title>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary-blue: #004E7C;
      --light-blue: #0066a1;
      --accent-teal: #4DD0E1;
      --bg-light: #f8f9fa;
      --text-dark: #1a1a1a;
      --text-light: #666;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --danger: #dc3545;
      --success: #28a745;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
    }
    
    #loginScreen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #004E7C 0%, #0066a1 100%);
    }
    
    .login-box {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 90%;
    }
    
    .login-box h1 {
      color: var(--primary-blue);
      margin-bottom: 0.5rem;
      font-size: 2rem;
    }
    
    .login-box p {
      color: var(--text-light);
      margin-bottom: 2rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-dark);
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-blue);
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .btn {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #004E7C, #0066a1);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,78,124,0.3);
    }
    
    .error-message {
      background: #fee;
      color: #c00;
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }
    
    #cmsPanel {
      display: none;
    }
    
    .cms-header {
      background: white;
      padding: 1.5rem 2rem;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .cms-header h1 {
      color: var(--primary-blue);
      font-size: 1.5rem;
    }
    
    .cms-header .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .btn-logout {
      padding: 0.5rem 1rem;
      background: var(--text-light);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .cms-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem;
    }
    
    .cms-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #ddd;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 1rem 1.5rem;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-light);
      transition: all 0.3s;
    }
    
    .tab.active {
      color: var(--primary-blue);
      border-bottom-color: var(--primary-blue);
    }
    
    .tab:hover {
      color: var(--primary-blue);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .content-section {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }
    
    .content-section h2 {
      color: var(--primary-blue);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }
    
    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }
    
    .preview-button {
      padding: 0.75rem 1.5rem;
      background: white;
      color: var(--primary-blue);
      border: 2px solid var(--primary-blue);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
    }
    
    .preview-button:hover {
      background: var(--primary-blue);
      color: white;
    }
    
    /* Team/Board Grid */
    .people-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .person-card {
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 1.5rem;
      position: relative;
      transition: all 0.3s;
      cursor: grab;
    }
    
    .person-card:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .person-card.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    
    .person-card.drag-over {
      border-color: var(--accent-teal);
      background: #e8f4f8;
    }
    
    .person-card-header {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .person-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-blue);
      flex-shrink: 0;
    }
    
    .person-photo-placeholder {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      flex-shrink: 0;
      border: 3px solid var(--primary-blue);
    }
    
    .person-info h4 {
      color: var(--primary-blue);
      margin-bottom: 0.25rem;
    }
    
    .person-info .role {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .person-info .contact {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-top: 0.5rem;
    }
    
    .person-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #ddd;
    }
    
    .btn-edit, .btn-delete {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      flex: 1;
    }
    
    .btn-edit {
      background: var(--primary-blue);
      color: white;
    }
    
    .btn-delete {
      background: var(--danger);
      color: white;
    }
    
    .btn-add-person {
      padding: 1rem 2rem;
      background: var(--accent-teal);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .btn-add-person:hover {
      background: #3dbfd0;
    }
    
    .drag-handle {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      color: #aaa;
      cursor: grab;
      font-size: 1.2rem;
    }
    
    .order-badge {
      position: absolute;
      top: 0.75rem;
      left: 0.75rem;
      background: var(--primary-blue);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      display: none;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal-box {
      background: white;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      color: var(--primary-blue);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid #ddd;
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    
    .btn-cancel {
      padding: 0.75rem 1.5rem;
      background: #ddd;
      color: var(--text-dark);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn-save {
      padding: 0.75rem 1.5rem;
      background: var(--primary-blue);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn-save:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    
    /* Photo Upload in Modal */
    .photo-upload-area {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .photo-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-blue);
      margin-bottom: 1rem;
    }
    
    .photo-preview-placeholder {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      margin: 0 auto 1rem;
      border: 3px dashed #ccc;
    }
    
    .btn-upload-photo {
      padding: 0.5rem 1rem;
      background: var(--light-blue);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .photo-hint {
      font-size: 0.8rem;
      color: var(--text-light);
      margin-top: 0.5rem;
    }
    
    .upload-progress {
      width: 100%;
      height: 6px;
      background: #eee;
      border-radius: 3px;
      margin-top: 0.5rem;
      overflow: hidden;
      display: none;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: var(--primary-blue);
      width: 0%;
      transition: width 0.3s;
    }
    
    /* Loading State */
    .loading-spinner {
      text-align: center;
      padding: 3rem;
      color: var(--text-light);
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-light);
    }
    
    .empty-state p {
      margin-bottom: 1rem;
    }
    
    /* Gallery CMS Grid */
    .gallery-cms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.5rem;
    }
    
    .gallery-card {
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: grab;
      position: relative;
    }
    
    .gallery-card:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .gallery-card.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    
    .gallery-card.drag-over {
      border-color: var(--accent-teal);
      background: #e8f4f8;
    }
    
    .gallery-card-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    
    .gallery-card-placeholder {
      width: 100%;
      height: 150px;
      background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #999;
    }
    
    .gallery-card-info {
      padding: 1rem;
    }
    
    .gallery-card-info h4 {
      color: var(--primary-blue);
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .gallery-card-info .caption {
      color: var(--text-light);
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .gallery-card-actions {
      display: flex;
      gap: 0.5rem;
      padding: 0 1rem 1rem;
    }
    
    .gallery-card-actions button {
      flex: 1;
      padding: 0.4rem;
      font-size: 0.8rem;
    }
    
    .gallery-order-badge {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: var(--primary-blue);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      z-index: 1;
    }
    
    .gallery-drag-handle {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      color: white;
      background: rgba(0,0,0,0.4);
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      cursor: grab;
      font-size: 1rem;
      z-index: 1;
    }
    
    /* Resources Grid */
    .resources-grid {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .resource-card {
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 1.25rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      transition: all 0.3s;
    }
    
    .resource-card:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .resource-logo {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: contain;
      background: white;
      padding: 4px;
      border: 1px solid #e2e8f0;
      flex-shrink: 0;
    }
    
    .resource-logo-placeholder {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary-blue), var(--light-blue));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    
    .resource-info {
      flex: 1;
      min-width: 0;
    }
    
    .resource-info h4 {
      color: var(--primary-blue);
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }
    
    .resource-type-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #e0f2fe;
      color: #0369a1;
      border-radius: 50px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .resource-meta {
      font-size: 0.85rem;
      color: var(--text-light);
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    
    .resource-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .resource-actions {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .cms-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .cms-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 0.5rem;
      }
      
      .tab {
        padding: 0.75rem 1rem;
        white-space: nowrap;
      }
      
      .people-grid {
        grid-template-columns: 1fr;
      }
      
      .resource-card {
        flex-direction: column;
      }
      
      .resource-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <div class="login-box">
      <h1>LDAH CMS</h1>
      <p>Content Management System</p>
      
      <div class="error-message" id="loginError"></div>
      
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required placeholder="Enter CMS password">
        </div>
        
        <button type="submit" class="btn btn-primary">Sign In</button>
      </form>
    </div>
  </div>

  <!-- CMS Panel -->
  <div id="cmsPanel">
    <div class="cms-header">
      <h1>üìù LDAH Content Management</h1>
      <div class="user-info">
        <a href="whoweare.html" class="preview-button" target="_blank">Preview Who We Are</a>
        <a href="resources.html" class="preview-button" target="_blank">Preview Resources</a>
        <a href="index.html" class="preview-button" target="_blank">Preview Site</a>
        <button class="btn-logout" onclick="handleLogout()">Logout</button>
      </div>
    </div>
    
    <div class="cms-container">
      <!-- Tabs -->
      <div class="cms-tabs">
        <button class="tab active" data-tab="team">üë• Our Team</button>
        <button class="tab" data-tab="board">üèÜ Board of Directors</button>
        <button class="tab" data-tab="gallery">üì∏ Photo Gallery</button>
        <button class="tab" data-tab="resources">üìö Resources</button>
      </div>
      
      <!-- Team Tab -->
      <div class="tab-content active" id="team-tab">
        <div class="content-section">
          <h2>üë• Manage Our Team</h2>
          <p style="color: var(--text-light); margin-bottom: 1.5rem;">
            Add, edit, or remove team members. Drag cards to reorder. Changes appear on the Who We Are page.
          </p>
          
          <div class="success-message" id="teamSuccess">Changes saved successfully!</div>
          
          <button class="btn-add-person" onclick="openPersonModal('team')">+ Add Team Member</button>
          
          <div id="teamLoading" class="loading-spinner">Loading team members...</div>
          <div id="teamEmpty" class="empty-state" style="display:none;">
            <p>No team members yet.</p>
            <button class="btn-add-person" onclick="openPersonModal('team')">+ Add Your First Team Member</button>
          </div>
          <div class="people-grid" id="teamGrid"></div>
        </div>
      </div>
      
      <!-- Board Tab -->
      <div class="tab-content" id="board-tab">
        <div class="content-section">
          <h2>üèÜ Manage Board of Directors</h2>
          <p style="color: var(--text-light); margin-bottom: 1.5rem;">
            Add, edit, or remove board members. Drag cards to reorder. Changes appear on the Who We Are page.
          </p>
          
          <div class="success-message" id="boardSuccess">Changes saved successfully!</div>
          
          <button class="btn-add-person" onclick="openPersonModal('board')">+ Add Board Member</button>
          
          <div id="boardLoading" class="loading-spinner">Loading board members...</div>
          <div id="boardEmpty" class="empty-state" style="display:none;">
            <p>No board members yet.</p>
            <button class="btn-add-person" onclick="openPersonModal('board')">+ Add Your First Board Member</button>
          </div>
          <div class="people-grid" id="boardGrid"></div>
        </div>
      </div>
      
      <!-- Gallery Tab -->
      <div class="tab-content" id="gallery-tab">
        <div class="content-section">
          <h2>üì∏ Manage Photo Gallery</h2>
          <p style="color: var(--text-light); margin-bottom: 1.5rem;">
            Add, edit, or remove photos from the gallery. Drag cards to reorder. Changes appear on the Who We Are page.
          </p>
          
          <div class="success-message" id="gallerySuccess">Changes saved successfully!</div>
          
          <button class="btn-add-person" onclick="openGalleryModal()" style="background: linear-gradient(135deg, #10b981, #059669);">+ Add Photo</button>
          
          <div id="galleryLoading" class="loading-spinner">Loading gallery...</div>
          <div id="galleryEmpty" class="empty-state" style="display:none;">
            <p>No photos in gallery yet.</p>
            <button class="btn-add-person" onclick="openGalleryModal()" style="background: linear-gradient(135deg, #10b981, #059669);">+ Add Your First Photo</button>
          </div>
          <div id="galleryCount" style="color: var(--text-light); margin-bottom: 1rem;"></div>
          <div class="gallery-cms-grid" id="galleryGrid"></div>
        </div>
      </div>
      
      <!-- Resources Tab -->
      <div class="tab-content" id="resources-tab">
        <div class="content-section">
          <h2>üìö Manage Resources</h2>
          <p style="color: var(--text-light); margin-bottom: 1.5rem;">
            Add, edit, or remove community resources. These appear on the Resources page for families to find support services.
          </p>
          
          <div class="success-message" id="resourcesSuccess">Changes saved successfully!</div>
          
          <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
            <button class="btn-add-person" onclick="openResourceModal()">+ Add Resource</button>
            <input type="text" id="resourceSearch" placeholder="üîç Search resources..." 
                   style="padding: 0.75rem 1rem; border: 2px solid #ddd; border-radius: 8px; flex: 1; min-width: 200px;"
                   oninput="filterResourcesList()">
          </div>
          
          <div id="resourcesLoading" class="loading-spinner">Loading resources...</div>
          <div id="resourcesEmpty" class="empty-state" style="display:none;">
            <p>No resources yet.</p>
            <button class="btn-add-person" onclick="openResourceModal()">+ Add Your First Resource</button>
          </div>
          <div id="resourcesCount" style="color: var(--text-light); margin-bottom: 1rem;"></div>
          <div class="resources-grid" id="resourcesGrid"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Person Modal -->
  <div class="modal-overlay" id="personModal">
    <div class="modal-box">
      <div class="modal-header">
        <h3 id="modalTitle">Add Team Member</h3>
        <button class="modal-close" onclick="closePersonModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="personId">
        <input type="hidden" id="personType">
        <input type="hidden" id="personPhotoUrl">
        
        <div class="photo-upload-area">
          <div id="photoPreviewContainer">
            <div class="photo-preview-placeholder" id="photoPlaceholder">üë§</div>
          </div>
          <input type="file" id="photoInput" accept="image/jpeg,image/png,image/webp" style="display:none;" onchange="handlePhotoSelect(event)">
          <button type="button" class="btn-upload-photo" onclick="document.getElementById('photoInput').click()">
            üì∑ Choose Photo
          </button>
          <p class="photo-hint">Max 2MB. JPG, PNG, or WebP.</p>
          <div class="upload-progress" id="uploadProgress">
            <div class="upload-progress-bar" id="uploadProgressBar"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="personName" placeholder="e.g., John Smith" required>
        </div>
        
        <div class="form-group">
          <label>Title / Role *</label>
          <input type="text" id="personRole" placeholder="e.g., Executive Director">
        </div>
        
        <div class="form-group" id="phoneGroup">
          <label>Phone Number</label>
          <input type="tel" id="personPhone" placeholder="e.g., (808) 555-1234">
        </div>
        
        <div class="form-group" id="emailGroup">
          <label>Email Address</label>
          <input type="email" id="personEmail" placeholder="e.g., john@ldah.org">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closePersonModal()">Cancel</button>
        <button class="btn-save" id="savePersonBtn" onclick="savePerson()">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-box" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to remove <strong id="deletePersonName"></strong>?</p>
        <p style="color: var(--text-light); margin-top: 0.5rem; font-size: 0.9rem;">This will also delete their photo. This action cannot be undone.</p>
        <input type="hidden" id="deletePersonId">
        <input type="hidden" id="deletePersonType">
        <input type="hidden" id="deletePhotoUrl">
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
        <button class="btn-delete" onclick="confirmDelete()" style="flex: none; padding: 0.75rem 1.5rem;">Delete</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Resource Modal -->
  <div class="modal-overlay" id="resourceModal">

  <!-- Add/Edit Gallery Photo Modal -->
  <div class="modal-overlay" id="galleryModal">
    <div class="modal-box" style="max-width: 500px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669);">
        <h3 id="galleryModalTitle" style="color: white;">Add Photo</h3>
        <button class="modal-close" onclick="closeGalleryModal()" style="color: white;">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="galleryPhotoId">
        <input type="hidden" id="galleryPhotoUrl">
        
        <div class="photo-upload-area">
          <div id="galleryPreviewContainer">
            <div class="photo-preview-placeholder" id="galleryPlaceholder" style="width: 200px; height: 150px; border-radius: 8px; font-size: 3rem;">üì∑</div>
          </div>
          <input type="file" id="galleryPhotoInput" accept="image/jpeg,image/png,image/webp" style="display:none;" onchange="handleGalleryPhotoSelect(event)">
          <button type="button" class="btn-upload-photo" onclick="document.getElementById('galleryPhotoInput').click()" style="background: linear-gradient(135deg, #10b981, #059669);">
            üì∑ Choose Photo
          </button>
          <p class="photo-hint">Max 2MB. JPG, PNG, or WebP.</p>
          <div class="upload-progress" id="galleryUploadProgress">
            <div class="upload-progress-bar" id="galleryUploadProgressBar"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Photo Caption / Alt Text *</label>
          <input type="text" id="galleryCaption" placeholder="e.g., LDAH Community Event 2024" required>
        </div>
        
        <div class="form-group">
          <label>Or Enter Image URL</label>
          <input type="url" id="galleryImageUrl" placeholder="https://example.com/photo.jpg" oninput="previewGalleryUrl()">
          <p style="font-size: 0.8rem; color: var(--text-light); margin-top: 0.5rem;">
            Tip: You can paste a URL from Firebase Storage, Instagram, or any public image.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeGalleryModal()">Cancel</button>
        <button class="btn-save" id="saveGalleryBtn" onclick="saveGalleryPhoto()" style="background: linear-gradient(135deg, #10b981, #059669);">Save Photo</button>
      </div>
    </div>
  </div>

  <!-- Delete Gallery Photo Modal -->
  <div class="modal-overlay" id="deleteGalleryModal">
    <div class="modal-box" style="max-width: 400px;">
      <div class="modal-header" style="background: var(--danger);">
        <h3 style="color: white;">Delete Photo</h3>
        <button class="modal-close" onclick="closeDeleteGalleryModal()" style="color: white;">&times;</button>
      </div>
      <div class="modal-body">
        <div style="text-align: center; margin-bottom: 1rem;">
          <img id="deleteGalleryPreview" src="" alt="" style="max-width: 200px; max-height: 150px; border-radius: 8px; object-fit: cover;">
        </div>
        <p>Are you sure you want to remove this photo?</p>
        <p style="color: var(--text-light); margin-top: 0.5rem; font-size: 0.9rem;">This action cannot be undone.</p>
        <input type="hidden" id="deleteGalleryId">
        <input type="hidden" id="deleteGalleryPhotoUrl">
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeDeleteGalleryModal()">Cancel</button>
        <button class="btn-delete" onclick="confirmDeleteGallery()" style="flex: none; padding: 0.75rem 1.5rem;">Delete</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Resource Modal (original) -->
    <div class="modal-box" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="resourceModalTitle">Add Resource</h3>
        <button class="modal-close" onclick="closeResourceModal()">&times;</button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <input type="hidden" id="resourceId">
        <input type="hidden" id="resourceLogoUrl">
        
        <div class="form-group">
          <label>Organization Name *</label>
          <input type="text" id="resourceName" placeholder="e.g., Hawaii Centers for Independent Living" required>
        </div>
        
        <div class="form-group">
          <label>Resource Type *</label>
          <select id="resourceType" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px;">
            <option value="Specialized Resources">Specialized Resources</option>
            <option value="Educational Testing Resources">Educational Testing Resources</option>
            <option value="Private School Resources">Private School Resources</option>
            <option value="Special Education Tutoring Resources">Special Education Tutoring Resources</option>
            <option value="Transition Resources">Transition Resources</option>
            <option value="Mental Health Therapist">Mental Health Therapist</option>
            <option value="Medical Doctor">Medical Doctor</option>
            <option value="Support Services">Support Services</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Contact Person</label>
          <input type="text" id="resourcePerson" placeholder="e.g., Dr. Jane Smith">
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="resourcePhone" placeholder="(808) 555-1234">
          </div>
          <div class="form-group">
            <label>Fax</label>
            <input type="tel" id="resourceFax" placeholder="(808) 555-1235">
          </div>
        </div>
        
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="resourceEmail" placeholder="info@example.org">
        </div>
        
        <div class="form-group">
          <label>Website</label>
          <input type="url" id="resourceWebsite" placeholder="https://www.example.org">
        </div>
        
        <div class="form-group">
          <label>Street Address</label>
          <input type="text" id="resourceAddress" placeholder="123 Main Street, Suite 100">
        </div>
        
        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="resourceCity" placeholder="Honolulu">
          </div>
          <div class="form-group">
            <label>State</label>
            <input type="text" id="resourceState" placeholder="HI" value="HI" maxlength="2">
          </div>
          <div class="form-group">
            <label>Zip</label>
            <input type="text" id="resourceZip" placeholder="96813" maxlength="10">
          </div>
        </div>
        
        <div class="form-group">
          <label>Island</label>
          <select id="resourceIsland" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 8px;">
            <option value="">-- Select Island --</option>
            <option value="Oahu">Oahu</option>
            <option value="Hawaii">Hawaii (Big Island)</option>
            <option value="Maui">Maui</option>
            <option value="Kauai">Kauai</option>
            <option value="Molokai">Molokai</option>
            <option value="Lanai">Lanai</option>
            <option value="Statewide">Statewide</option>
            <option value="Off Island">Off Island</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Services Offered</label>
          <textarea id="resourceServices" rows="4" placeholder="Describe the services this organization provides..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Notes (internal)</label>
          <input type="text" id="resourceNotes" placeholder="e.g., Rev. 8/25, Contact updated">
        </div>
        
        <div class="form-group">
          <label>Logo URL (optional)</label>
          <input type="url" id="resourceLogoInput" placeholder="https://example.com/logo.png">
          <p style="font-size: 0.8rem; color: var(--text-light); margin-top: 0.5rem;">
            Paste a direct link to the organization's logo image
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeResourceModal()">Cancel</button>
        <button class="btn-save" id="saveResourceBtn" onclick="saveResource()">Save Resource</button>
      </div>
    </div>
  </div>

  <!-- Delete Resource Confirmation Modal -->
  <div class="modal-overlay" id="deleteResourceModal">
    <div class="modal-box" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="modal-close" onclick="closeDeleteResourceModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to remove <strong id="deleteResourceName"></strong>?</p>
        <p style="color: var(--text-light); margin-top: 0.5rem; font-size: 0.9rem;">This action cannot be undone.</p>
        <input type="hidden" id="deleteResourceId">
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closeDeleteResourceModal()">Cancel</button>
        <button class="btn-delete" onclick="confirmDeleteResource()" style="flex: none; padding: 0.75rem 1.5rem;">Delete</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const storage = firebase.storage();
    const auth = firebase.auth();

    // Password
    const CMS_PASSWORD = 'ldah2024';
    const MAX_FILE_SIZE = 2 * 1024 * 1024; // 2MB

    // State
    let teamMembers = [];
    let boardMembers = [];
    let galleryPhotos = [];
    let selectedPhotoFile = null;
    let selectedGalleryFile = null;
    let draggedItem = null;
    let draggedGalleryItem = null;

    // ===== Authentication =====
    function handleLogin(event) {
      event.preventDefault();
      const password = document.getElementById('password').value;
      const errorDiv = document.getElementById('loginError');
      
      if (password === CMS_PASSWORD) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('cmsPanel').style.display = 'block';
        sessionStorage.setItem('cmsLoggedIn', 'true');
        initializeCMS();
      } else {
        errorDiv.textContent = 'Incorrect password. Please try again.';
        errorDiv.style.display = 'block';
        document.getElementById('password').value = '';
      }
    }
    
    function handleLogout() {
      sessionStorage.removeItem('cmsLoggedIn');
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('cmsPanel').style.display = 'none';
      document.getElementById('password').value = '';
      document.getElementById('loginError').style.display = 'none';
    }

    // ===== Initialize CMS =====
    async function initializeCMS() {
      try {
        await auth.signInAnonymously();
        loadTeamMembers();
        loadBoardMembers();
        loadGallery();
        loadResources();
      } catch (error) {
        console.error('Firebase auth error:', error);
      }
    }

    // ===== Tab Navigation =====
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      });
    });

    // ===== Load Data =====
    async function loadTeamMembers() {
      const loading = document.getElementById('teamLoading');
      const empty = document.getElementById('teamEmpty');
      const grid = document.getElementById('teamGrid');
      
      loading.style.display = 'block';
      empty.style.display = 'none';
      grid.innerHTML = '';
      
      try {
        let snapshot;
        try {
          snapshot = await db.collection('teamMembers').orderBy('order').get();
        } catch (indexError) {
          console.log('Index not available, falling back to client-side sort');
          snapshot = await db.collection('teamMembers').get();
        }
        
        teamMembers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        teamMembers.sort((a, b) => (a.order || 0) - (b.order || 0));
        
        loading.style.display = 'none';
        
        if (teamMembers.length === 0) {
          empty.style.display = 'block';
        } else {
          renderPeopleGrid(teamMembers, 'team', grid);
        }
      } catch (error) {
        console.error('Error loading team:', error);
        loading.style.display = 'none';
        empty.style.display = 'block';
        empty.innerHTML = '<p>No team members yet. Click "Add Team Member" to get started!</p>';
      }
    }

    async function loadBoardMembers() {
      const loading = document.getElementById('boardLoading');
      const empty = document.getElementById('boardEmpty');
      const grid = document.getElementById('boardGrid');
      
      loading.style.display = 'block';
      empty.style.display = 'none';
      grid.innerHTML = '';
      
      try {
        let snapshot;
        try {
          snapshot = await db.collection('boardMembers').orderBy('order').get();
        } catch (indexError) {
          console.log('Index not available, falling back to client-side sort');
          snapshot = await db.collection('boardMembers').get();
        }
        
        boardMembers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        boardMembers.sort((a, b) => (a.order || 0) - (b.order || 0));
        
        loading.style.display = 'none';
        
        if (boardMembers.length === 0) {
          empty.style.display = 'block';
        } else {
          renderPeopleGrid(boardMembers, 'board', grid);
        }
      } catch (error) {
        console.error('Error loading board:', error);
        loading.style.display = 'none';
        empty.style.display = 'block';
        empty.innerHTML = '<p>No board members yet. Click "Add Board Member" to get started!</p>';
      }
    }

    // ===== Render Grid =====
    function renderPeopleGrid(people, type, container) {
      container.innerHTML = '';
      
      people.forEach((person, index) => {
        const card = document.createElement('div');
        card.className = 'person-card';
        card.draggable = true;
        card.dataset.id = person.id;
        card.dataset.type = type;
        
        const photoHtml = person.photoUrl 
          ? `<img src="${person.photoUrl}" alt="${person.name}" class="person-photo">`
          : `<div class="person-photo-placeholder">üë§</div>`;
        
        const contactHtml = type === 'team' ? `
          <div class="contact">
            ${person.phone ? `üìû ${person.phone}` : ''}
            ${person.phone && person.email ? ' ‚Ä¢ ' : ''}
            ${person.email ? `‚úâÔ∏è ${person.email}` : ''}
          </div>
        ` : '';
        
        card.innerHTML = `
          <div class="order-badge">${index + 1}</div>
          <div class="drag-handle">‚ãÆ‚ãÆ</div>
          <div class="person-card-header">
            ${photoHtml}
            <div class="person-info">
              <h4>${person.name}</h4>
              <div class="role">${person.role}</div>
              ${contactHtml}
            </div>
          </div>
          <div class="person-actions">
            <button class="btn-edit" onclick="editPerson('${type}', '${person.id}')">‚úèÔ∏è Edit</button>
            <button class="btn-delete" onclick="deletePerson('${type}', '${person.id}', '${person.name}', '${person.photoUrl || ''}')">üóëÔ∏è Delete</button>
          </div>
        `;
        
        // Drag events
        card.addEventListener('dragstart', handleDragStart);
        card.addEventListener('dragend', handleDragEnd);
        card.addEventListener('dragover', handleDragOver);
        card.addEventListener('drop', handleDrop);
        card.addEventListener('dragleave', handleDragLeave);
        
        container.appendChild(card);
      });
    }

    // ===== Drag and Drop =====
    function handleDragStart(e) {
      draggedItem = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      document.querySelectorAll('.person-card').forEach(card => {
        card.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      if (this !== draggedItem && this.dataset.type === draggedItem.dataset.type) {
        this.classList.add('drag-over');
      }
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    async function handleDrop(e) {
      e.preventDefault();
      this.classList.remove('drag-over');
      
      if (this === draggedItem || this.dataset.type !== draggedItem.dataset.type) return;
      
      const type = this.dataset.type;
      const collection = type === 'team' ? 'teamMembers' : 'boardMembers';
      const members = type === 'team' ? teamMembers : boardMembers;
      const grid = document.getElementById(type + 'Grid');
      
      const draggedId = draggedItem.dataset.id;
      const targetId = this.dataset.id;
      
      const draggedIndex = members.findIndex(m => m.id === draggedId);
      const targetIndex = members.findIndex(m => m.id === targetId);
      
      // Reorder array
      const [removed] = members.splice(draggedIndex, 1);
      members.splice(targetIndex, 0, removed);
      
      // Update order in Firestore
      const batch = db.batch();
      members.forEach((member, index) => {
        const ref = db.collection(collection).doc(member.id);
        batch.update(ref, { order: index });
        member.order = index;
      });
      
      try {
        await batch.commit();
        renderPeopleGrid(members, type, grid);
        showSuccess(type);
      } catch (error) {
        console.error('Error updating order:', error);
        alert('Failed to update order. Please try again.');
      }
    }

    // ===== Modal Functions =====
    function openPersonModal(type, person = null) {
      document.getElementById('personModal').classList.add('active');
      document.getElementById('personType').value = type;
      
      const isTeam = type === 'team';
      document.getElementById('phoneGroup').style.display = isTeam ? 'block' : 'none';
      document.getElementById('emailGroup').style.display = isTeam ? 'block' : 'none';
      
      if (person) {
        document.getElementById('modalTitle').textContent = isTeam ? 'Edit Team Member' : 'Edit Board Member';
        document.getElementById('personId').value = person.id;
        document.getElementById('personName').value = person.name || '';
        document.getElementById('personRole').value = person.role || '';
        document.getElementById('personPhone').value = person.phone || '';
        document.getElementById('personEmail').value = person.email || '';
        document.getElementById('personPhotoUrl').value = person.photoUrl || '';
        
        if (person.photoUrl) {
          document.getElementById('photoPreviewContainer').innerHTML = 
            `<img src="${person.photoUrl}" class="photo-preview" id="photoPreview">`;
        } else {
          document.getElementById('photoPreviewContainer').innerHTML = 
            `<div class="photo-preview-placeholder" id="photoPlaceholder">üë§</div>`;
        }
      } else {
        document.getElementById('modalTitle').textContent = isTeam ? 'Add Team Member' : 'Add Board Member';
        document.getElementById('personId').value = '';
        document.getElementById('personName').value = '';
        document.getElementById('personRole').value = '';
        document.getElementById('personPhone').value = '';
        document.getElementById('personEmail').value = '';
        document.getElementById('personPhotoUrl').value = '';
        document.getElementById('photoPreviewContainer').innerHTML = 
          `<div class="photo-preview-placeholder" id="photoPlaceholder">üë§</div>`;
      }
      
      selectedPhotoFile = null;
      document.getElementById('photoInput').value = '';
    }

    function closePersonModal() {
      document.getElementById('personModal').classList.remove('active');
      selectedPhotoFile = null;
    }

    function editPerson(type, id) {
      const members = type === 'team' ? teamMembers : boardMembers;
      const person = members.find(m => m.id === id);
      if (person) {
        openPersonModal(type, person);
      }
    }

    // ===== Photo Handling =====
    function handlePhotoSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (file.size > MAX_FILE_SIZE) {
        alert('Photo must be under 2MB. Please choose a smaller image.');
        event.target.value = '';
        return;
      }
      
      if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
        alert('Please select a JPG, PNG, or WebP image.');
        event.target.value = '';
        return;
      }
      
      selectedPhotoFile = file;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('photoPreviewContainer').innerHTML = 
          `<img src="${e.target.result}" class="photo-preview" id="photoPreview">`;
      };
      reader.readAsDataURL(file);
    }

    async function uploadPhoto(file, personId, type) {
      const extension = file.name.split('.').pop();
      const filename = `${type}/${personId}_${Date.now()}.${extension}`;
      const storageRef = storage.ref(filename);
      
      const progressBar = document.getElementById('uploadProgress');
      const progressFill = document.getElementById('uploadProgressBar');
      progressBar.style.display = 'block';
      
      return new Promise((resolve, reject) => {
        const uploadTask = storageRef.put(file);
        
        uploadTask.on('state_changed',
          (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            progressFill.style.width = progress + '%';
          },
          (error) => {
            progressBar.style.display = 'none';
            reject(error);
          },
          async () => {
            progressBar.style.display = 'none';
            const downloadUrl = await uploadTask.snapshot.ref.getDownloadURL();
            resolve(downloadUrl);
          }
        );
      });
    }

    async function deletePhotoFromStorage(photoUrl) {
      if (!photoUrl || !photoUrl.includes('firebase')) return;
      
      try {
        const photoRef = storage.refFromURL(photoUrl);
        await photoRef.delete();
      } catch (error) {
        console.error('Error deleting photo:', error);
        // Don't throw - photo deletion failure shouldn't block other operations
      }
    }

    // ===== Save Person =====
    async function savePerson() {
      const name = document.getElementById('personName').value.trim();
      const role = document.getElementById('personRole').value.trim();
      const type = document.getElementById('personType').value;
      const existingId = document.getElementById('personId').value;
      const existingPhotoUrl = document.getElementById('personPhotoUrl').value;
      
      if (!name || !role) {
        alert('Please fill in Name and Role.');
        return;
      }
      
      const saveBtn = document.getElementById('savePersonBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Saving...';
      
      try {
        const collection = type === 'team' ? 'teamMembers' : 'boardMembers';
        const members = type === 'team' ? teamMembers : boardMembers;
        
        let photoUrl = existingPhotoUrl;
        
        // Upload new photo if selected
        if (selectedPhotoFile) {
          const tempId = existingId || db.collection(collection).doc().id;
          
          // Delete old photo if replacing
          if (existingPhotoUrl) {
            await deletePhotoFromStorage(existingPhotoUrl);
          }
          
          photoUrl = await uploadPhoto(selectedPhotoFile, tempId, type);
        }
        
        const personData = {
          name,
          role,
          photoUrl: photoUrl || '',
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (type === 'team') {
          personData.phone = document.getElementById('personPhone').value.trim();
          personData.email = document.getElementById('personEmail').value.trim();
        }
        
        if (existingId) {
          // Update existing
          await db.collection(collection).doc(existingId).update(personData);
        } else {
          // Add new
          personData.order = members.length;
          personData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          await db.collection(collection).add(personData);
        }
        
        closePersonModal();
        
        if (type === 'team') {
          await loadTeamMembers();
        } else {
          await loadBoardMembers();
        }
        
        showSuccess(type);
        
      } catch (error) {
        console.error('Error saving person:', error);
        alert('Failed to save. Please try again.');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save';
      }
    }

    // ===== Delete Person =====
    function deletePerson(type, id, name, photoUrl) {
      document.getElementById('deletePersonId').value = id;
      document.getElementById('deletePersonType').value = type;
      document.getElementById('deletePersonName').textContent = name;
      document.getElementById('deletePhotoUrl').value = photoUrl;
      document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
    }

    async function confirmDelete() {
      const id = document.getElementById('deletePersonId').value;
      const type = document.getElementById('deletePersonType').value;
      const photoUrl = document.getElementById('deletePhotoUrl').value;
      
      try {
        const collection = type === 'team' ? 'teamMembers' : 'boardMembers';
        
        // Delete from Firestore
        await db.collection(collection).doc(id).delete();
        
        // Delete photo from storage
        if (photoUrl) {
          await deletePhotoFromStorage(photoUrl);
        }
        
        closeDeleteModal();
        
        if (type === 'team') {
          await loadTeamMembers();
        } else {
          await loadBoardMembers();
        }
        
        showSuccess(type);
        
      } catch (error) {
        console.error('Error deleting person:', error);
        alert('Failed to delete. Please try again.');
      }
    }

    // ===== RESOURCES MANAGEMENT =====
    let resources = [];
    let filteredResources = [];

    // Load resources from Firebase
    async function loadResources() {
      const loading = document.getElementById('resourcesLoading');
      const empty = document.getElementById('resourcesEmpty');
      const grid = document.getElementById('resourcesGrid');
      const countEl = document.getElementById('resourcesCount');
      
      loading.style.display = 'block';
      empty.style.display = 'none';
      grid.innerHTML = '';
      
      try {
        let snapshot;
        try {
          snapshot = await db.collection('resources').orderBy('name').get();
        } catch (indexError) {
          console.log('Index not available, using unordered query');
          snapshot = await db.collection('resources').get();
        }
        
        resources = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        resources.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
        
        loading.style.display = 'none';
        
        if (resources.length === 0) {
          empty.style.display = 'block';
          countEl.textContent = '';
        } else {
          countEl.textContent = `Showing ${resources.length} resources`;
          filteredResources = [...resources];
          renderResourcesGrid();
        }
      } catch (error) {
        console.error('Error loading resources:', error);
        loading.style.display = 'none';
        empty.style.display = 'block';
        empty.innerHTML = '<p>Error loading resources. Please refresh.</p>';
      }
    }

    // Filter resources list
    function filterResourcesList() {
      const searchTerm = document.getElementById('resourceSearch').value.toLowerCase();
      const countEl = document.getElementById('resourcesCount');
      
      if (!searchTerm) {
        filteredResources = [...resources];
      } else {
        filteredResources = resources.filter(r => 
          (r.name || '').toLowerCase().includes(searchTerm) ||
          (r.services || '').toLowerCase().includes(searchTerm) ||
          (r.city || '').toLowerCase().includes(searchTerm) ||
          (r.type || '').toLowerCase().includes(searchTerm) ||
          (r.person || '').toLowerCase().includes(searchTerm)
        );
      }
      
      countEl.textContent = `Showing ${filteredResources.length} of ${resources.length} resources`;
      renderResourcesGrid();
    }

    // Render resources grid
    function renderResourcesGrid() {
      const grid = document.getElementById('resourcesGrid');
      grid.innerHTML = '';
      
      if (filteredResources.length === 0) {
        grid.innerHTML = '<div class="empty-state"><p>No matching resources found.</p></div>';
        return;
      }
      
      filteredResources.forEach(resource => {
        const card = document.createElement('div');
        card.className = 'resource-card';
        
        const logoHtml = resource.logo 
          ? `<img src="${resource.logo}" alt="${resource.name}" class="resource-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
             <div class="resource-logo-placeholder" style="display:none;">üè¢</div>`
          : `<div class="resource-logo-placeholder">üè¢</div>`;
        
        const island = resource.island || 'Statewide';
        const phone = resource.phone || '';
        const email = resource.email || '';
        
        card.innerHTML = `
          ${logoHtml}
          <div class="resource-info">
            <div class="resource-type-badge">${resource.type || 'Specialized Resources'}</div>
            <h4>${resource.name || 'Unnamed Resource'}</h4>
            <div class="resource-meta">
              <span>üìç ${island}</span>
              ${phone ? `<span>üìû ${phone}</span>` : ''}
              ${email ? `<span>‚úâÔ∏è ${email}</span>` : ''}
            </div>
          </div>
          <div class="resource-actions">
            <button class="btn-edit" onclick="editResource('${resource.id}')">‚úèÔ∏è Edit</button>
            <button class="btn-delete" onclick="deleteResource('${resource.id}', '${(resource.name || '').replace(/'/g, "\\'")}')">üóëÔ∏è</button>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // Open resource modal for add/edit
    function openResourceModal(resource = null) {
      document.getElementById('resourceModal').classList.add('active');
      
      if (resource) {
        document.getElementById('resourceModalTitle').textContent = 'Edit Resource';
        document.getElementById('resourceId').value = resource.id;
        document.getElementById('resourceName').value = resource.name || '';
        document.getElementById('resourceType').value = resource.type || 'Specialized Resources';
        document.getElementById('resourcePerson').value = resource.person || '';
        document.getElementById('resourcePhone').value = resource.phone || '';
        document.getElementById('resourceFax').value = resource.fax || '';
        document.getElementById('resourceEmail').value = resource.email || '';
        document.getElementById('resourceWebsite').value = resource.website || '';
        document.getElementById('resourceAddress').value = resource.address || '';
        document.getElementById('resourceCity').value = resource.city || '';
        document.getElementById('resourceState').value = resource.state || 'HI';
        document.getElementById('resourceZip').value = resource.zip || '';
        document.getElementById('resourceIsland').value = resource.island || '';
        document.getElementById('resourceServices').value = resource.services || '';
        document.getElementById('resourceNotes').value = resource.notes || '';
        document.getElementById('resourceLogoInput').value = resource.logo || '';
        document.getElementById('resourceLogoUrl').value = resource.logo || '';
      } else {
        document.getElementById('resourceModalTitle').textContent = 'Add Resource';
        document.getElementById('resourceId').value = '';
        document.getElementById('resourceName').value = '';
        document.getElementById('resourceType').value = 'Specialized Resources';
        document.getElementById('resourcePerson').value = '';
        document.getElementById('resourcePhone').value = '';
        document.getElementById('resourceFax').value = '';
        document.getElementById('resourceEmail').value = '';
        document.getElementById('resourceWebsite').value = '';
        document.getElementById('resourceAddress').value = '';
        document.getElementById('resourceCity').value = '';
        document.getElementById('resourceState').value = 'HI';
        document.getElementById('resourceZip').value = '';
        document.getElementById('resourceIsland').value = '';
        document.getElementById('resourceServices').value = '';
        document.getElementById('resourceNotes').value = '';
        document.getElementById('resourceLogoInput').value = '';
        document.getElementById('resourceLogoUrl').value = '';
      }
    }

    function closeResourceModal() {
      document.getElementById('resourceModal').classList.remove('active');
    }

    function editResource(id) {
      const resource = resources.find(r => r.id === id);
      if (resource) {
        openResourceModal(resource);
      }
    }

    // Save resource
    async function saveResource() {
      const name = document.getElementById('resourceName').value.trim();
      const type = document.getElementById('resourceType').value;
      const existingId = document.getElementById('resourceId').value;
      
      if (!name) {
        alert('Please enter an organization name.');
        return;
      }
      
      const saveBtn = document.getElementById('saveResourceBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Saving...';
      
      try {
        const resourceData = {
          name,
          type,
          person: document.getElementById('resourcePerson').value.trim(),
          phone: document.getElementById('resourcePhone').value.trim(),
          fax: document.getElementById('resourceFax').value.trim(),
          email: document.getElementById('resourceEmail').value.trim(),
          website: document.getElementById('resourceWebsite').value.trim(),
          address: document.getElementById('resourceAddress').value.trim(),
          city: document.getElementById('resourceCity').value.trim(),
          state: document.getElementById('resourceState').value.trim() || 'HI',
          zip: document.getElementById('resourceZip').value.trim(),
          island: document.getElementById('resourceIsland').value,
          services: document.getElementById('resourceServices').value.trim(),
          notes: document.getElementById('resourceNotes').value.trim(),
          logo: document.getElementById('resourceLogoInput').value.trim(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (existingId) {
          await db.collection('resources').doc(existingId).update(resourceData);
        } else {
          resourceData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          resourceData.order = resources.length;
          await db.collection('resources').add(resourceData);
        }
        
        closeResourceModal();
        await loadResources();
        showSuccess('resources');
        
      } catch (error) {
        console.error('Error saving resource:', error);
        alert('Failed to save resource. Please try again.');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save Resource';
      }
    }

    // Delete resource
    function deleteResource(id, name) {
      document.getElementById('deleteResourceId').value = id;
      document.getElementById('deleteResourceName').textContent = name;
      document.getElementById('deleteResourceModal').classList.add('active');
    }

    function closeDeleteResourceModal() {
      document.getElementById('deleteResourceModal').classList.remove('active');
    }

    async function confirmDeleteResource() {
      const id = document.getElementById('deleteResourceId').value;
      
      try {
        await db.collection('resources').doc(id).delete();
        closeDeleteResourceModal();
        await loadResources();
        showSuccess('resources');
      } catch (error) {
        console.error('Error deleting resource:', error);
        alert('Failed to delete resource. Please try again.');
      }
    }

    // ===== Gallery Functions =====
    async function loadGallery() {
      const loading = document.getElementById('galleryLoading');
      const empty = document.getElementById('galleryEmpty');
      const grid = document.getElementById('galleryGrid');
      const countEl = document.getElementById('galleryCount');
      
      loading.style.display = 'block';
      empty.style.display = 'none';
      grid.innerHTML = '';
      
      try {
        let snapshot;
        try {
          snapshot = await db.collection('gallery').orderBy('order').get();
        } catch (indexError) {
          console.log('Index not available, falling back to client-side sort');
          snapshot = await db.collection('gallery').get();
        }
        
        galleryPhotos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        galleryPhotos.sort((a, b) => (a.order || 0) - (b.order || 0));
        
        loading.style.display = 'none';
        
        if (galleryPhotos.length === 0) {
          empty.style.display = 'block';
          countEl.textContent = '';
        } else {
          countEl.textContent = `${galleryPhotos.length} photos in gallery`;
          renderGalleryGrid();
        }
      } catch (error) {
        console.error('Error loading gallery:', error);
        loading.style.display = 'none';
        empty.style.display = 'block';
        empty.innerHTML = `
          <p>Error loading gallery. Make sure Firestore rules are deployed.</p>
          <button class="btn-add-person" onclick="openGalleryModal()" style="background: linear-gradient(135deg, #10b981, #059669); margin-top: 1rem;">+ Add Your First Photo</button>
        `;
      }
    }
    
    function renderGalleryGrid() {
      const grid = document.getElementById('galleryGrid');
      grid.innerHTML = '';
      
      galleryPhotos.forEach((photo, index) => {
        const card = document.createElement('div');
        card.className = 'gallery-card';
        card.draggable = true;
        card.dataset.id = photo.id;
        card.dataset.index = index;
        
        // Drag events
        card.addEventListener('dragstart', handleGalleryDragStart);
        card.addEventListener('dragend', handleGalleryDragEnd);
        card.addEventListener('dragover', handleGalleryDragOver);
        card.addEventListener('dragleave', handleGalleryDragLeave);
        card.addEventListener('drop', handleGalleryDrop);
        
        card.innerHTML = `
          <div class="gallery-order-badge">${index + 1}</div>
          <div class="gallery-drag-handle">‚ãÆ‚ãÆ</div>
          ${photo.imageUrl 
            ? `<img src="${photo.imageUrl}" alt="${photo.caption || 'Gallery photo'}" class="gallery-card-image" onerror="this.onerror=null; this.parentElement.innerHTML = this.parentElement.innerHTML.replace(/<img[^>]*>/, '<div class=\\'gallery-card-placeholder\\'>üì∑</div>');">`
            : '<div class="gallery-card-placeholder">üì∑</div>'
          }
          <div class="gallery-card-info">
            <h4>${photo.caption || 'Untitled'}</h4>
          </div>
          <div class="gallery-card-actions">
            <button class="btn-edit" onclick="editGalleryPhoto('${photo.id}')">‚úèÔ∏è Edit</button>
            <button class="btn-delete" onclick="deleteGalleryPhoto('${photo.id}', '${(photo.caption || '').replace(/'/g, "\\'")}', '${photo.imageUrl || ''}')">üóëÔ∏è</button>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }
    
    // Gallery Drag and Drop
    function handleGalleryDragStart(e) {
      draggedGalleryItem = e.target.closest('.gallery-card');
      draggedGalleryItem.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }
    
    function handleGalleryDragEnd(e) {
      if (draggedGalleryItem) {
        draggedGalleryItem.classList.remove('dragging');
      }
      document.querySelectorAll('.gallery-card').forEach(card => {
        card.classList.remove('drag-over');
      });
      draggedGalleryItem = null;
    }
    
    function handleGalleryDragOver(e) {
      e.preventDefault();
      const card = e.target.closest('.gallery-card');
      if (card && card !== draggedGalleryItem) {
        card.classList.add('drag-over');
      }
    }
    
    function handleGalleryDragLeave(e) {
      const card = e.target.closest('.gallery-card');
      if (card) {
        card.classList.remove('drag-over');
      }
    }
    
    async function handleGalleryDrop(e) {
      e.preventDefault();
      const targetCard = e.target.closest('.gallery-card');
      
      if (!targetCard || !draggedGalleryItem || targetCard === draggedGalleryItem) return;
      
      targetCard.classList.remove('drag-over');
      
      const draggedId = draggedGalleryItem.dataset.id;
      const targetId = targetCard.dataset.id;
      
      const draggedIndex = galleryPhotos.findIndex(p => p.id === draggedId);
      const targetIndex = galleryPhotos.findIndex(p => p.id === targetId);
      
      // Reorder array
      const [removed] = galleryPhotos.splice(draggedIndex, 1);
      galleryPhotos.splice(targetIndex, 0, removed);
      
      // Update order in Firebase
      const batch = db.batch();
      galleryPhotos.forEach((photo, index) => {
        const ref = db.collection('gallery').doc(photo.id);
        batch.update(ref, { order: index });
      });
      
      try {
        await batch.commit();
        renderGalleryGrid();
        showSuccess('gallery');
      } catch (error) {
        console.error('Error reordering gallery:', error);
        loadGallery(); // Reload on error
      }
    }
    
    // Gallery Modal Functions
    function openGalleryModal(photo = null) {
      document.getElementById('galleryModal').classList.add('active');
      selectedGalleryFile = null;
      
      // Reset preview
      document.getElementById('galleryPreviewContainer').innerHTML = 
        '<div class="photo-preview-placeholder" id="galleryPlaceholder" style="width: 200px; height: 150px; border-radius: 8px; font-size: 3rem;">üì∑</div>';
      document.getElementById('galleryUploadProgress').style.display = 'none';
      
      if (photo) {
        document.getElementById('galleryModalTitle').textContent = 'Edit Photo';
        document.getElementById('galleryPhotoId').value = photo.id;
        document.getElementById('galleryPhotoUrl').value = photo.imageUrl || '';
        document.getElementById('galleryCaption').value = photo.caption || '';
        document.getElementById('galleryImageUrl').value = photo.imageUrl || '';
        
        if (photo.imageUrl) {
          document.getElementById('galleryPreviewContainer').innerHTML = 
            `<img src="${photo.imageUrl}" style="width: 200px; height: 150px; object-fit: cover; border-radius: 8px;">`;
        }
      } else {
        document.getElementById('galleryModalTitle').textContent = 'Add Photo';
        document.getElementById('galleryPhotoId').value = '';
        document.getElementById('galleryPhotoUrl').value = '';
        document.getElementById('galleryCaption').value = '';
        document.getElementById('galleryImageUrl').value = '';
      }
    }
    
    function closeGalleryModal() {
      document.getElementById('galleryModal').classList.remove('active');
      selectedGalleryFile = null;
    }
    
    function editGalleryPhoto(id) {
      const photo = galleryPhotos.find(p => p.id === id);
      if (photo) {
        openGalleryModal(photo);
      }
    }
    
    function handleGalleryPhotoSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (file.size > MAX_FILE_SIZE) {
        alert('Photo must be smaller than 2MB.');
        return;
      }
      
      if (!file.type.match(/^image\/(jpeg|png|webp)$/)) {
        alert('Please select a JPG, PNG, or WebP image.');
        return;
      }
      
      selectedGalleryFile = file;
      
      // Preview
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('galleryPreviewContainer').innerHTML = 
          `<img src="${e.target.result}" style="width: 200px; height: 150px; object-fit: cover; border-radius: 8px;">`;
        document.getElementById('galleryImageUrl').value = ''; // Clear URL input
      };
      reader.readAsDataURL(file);
    }
    
    function previewGalleryUrl() {
      const url = document.getElementById('galleryImageUrl').value.trim();
      if (url) {
        document.getElementById('galleryPreviewContainer').innerHTML = 
          `<img src="${url}" style="width: 200px; height: 150px; object-fit: cover; border-radius: 8px;" onerror="this.parentElement.innerHTML = '<div class=\\'photo-preview-placeholder\\' style=\\'width: 200px; height: 150px; border-radius: 8px; font-size: 3rem;\\'>‚ùå</div>';">`;
        selectedGalleryFile = null; // Clear file selection
      }
    }
    
    async function saveGalleryPhoto() {
      const caption = document.getElementById('galleryCaption').value.trim();
      const urlInput = document.getElementById('galleryImageUrl').value.trim();
      const existingId = document.getElementById('galleryPhotoId').value;
      const existingUrl = document.getElementById('galleryPhotoUrl').value;
      
      if (!caption) {
        alert('Please enter a caption for the photo.');
        return;
      }
      
      if (!selectedGalleryFile && !urlInput && !existingUrl) {
        alert('Please select a photo or enter an image URL.');
        return;
      }
      
      const saveBtn = document.getElementById('saveGalleryBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Saving...';
      
      try {
        let imageUrl = urlInput || existingUrl;
        
        // Upload new file if selected
        if (selectedGalleryFile) {
          const progressBar = document.getElementById('galleryUploadProgress');
          const progressFill = document.getElementById('galleryUploadProgressBar');
          progressBar.style.display = 'block';
          
          const fileName = `gallery/${Date.now()}_${selectedGalleryFile.name}`;
          const storageRef = storage.ref(fileName);
          const uploadTask = storageRef.put(selectedGalleryFile);
          
          imageUrl = await new Promise((resolve, reject) => {
            uploadTask.on('state_changed',
              (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressFill.style.width = progress + '%';
              },
              reject,
              async () => {
                const url = await uploadTask.snapshot.ref.getDownloadURL();
                resolve(url);
              }
            );
          });
          
          progressBar.style.display = 'none';
        }
        
        const photoData = {
          caption,
          imageUrl,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (existingId) {
          await db.collection('gallery').doc(existingId).update(photoData);
        } else {
          photoData.order = galleryPhotos.length;
          photoData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          await db.collection('gallery').add(photoData);
        }
        
        closeGalleryModal();
        await loadGallery();
        showSuccess('gallery');
        
      } catch (error) {
        console.error('Error saving photo:', error);
        alert('Failed to save photo. Please try again.');
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save Photo';
      }
    }
    
    function deleteGalleryPhoto(id, caption, imageUrl) {
      document.getElementById('deleteGalleryId').value = id;
      document.getElementById('deleteGalleryPhotoUrl').value = imageUrl;
      document.getElementById('deleteGalleryPreview').src = imageUrl;
      document.getElementById('deleteGalleryModal').classList.add('active');
    }
    
    function closeDeleteGalleryModal() {
      document.getElementById('deleteGalleryModal').classList.remove('active');
    }
    
    async function confirmDeleteGallery() {
      const id = document.getElementById('deleteGalleryId').value;
      const photoUrl = document.getElementById('deleteGalleryPhotoUrl').value;
      
      try {
        // Delete from Firestore
        await db.collection('gallery').doc(id).delete();
        
        // Try to delete from Storage if it's a Firebase Storage URL
        if (photoUrl && photoUrl.includes('firebasestorage.googleapis.com')) {
          try {
            const storageRef = storage.refFromURL(photoUrl);
            await storageRef.delete();
          } catch (e) {
            console.log('Could not delete from storage:', e);
          }
        }
        
        closeDeleteGalleryModal();
        await loadGallery();
        showSuccess('gallery');
      } catch (error) {
        console.error('Error deleting photo:', error);
        alert('Failed to delete photo. Please try again.');
      }
    }

    // ===== Utility =====
    function showSuccess(type) {
      const successEl = document.getElementById(type + 'Success');
      successEl.style.display = 'block';
      setTimeout(() => {
        successEl.style.display = 'none';
      }, 3000);
    }

    // ===== Init on Load =====
    window.addEventListener('load', () => {
      if (sessionStorage.getItem('cmsLoggedIn') === 'true') {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('cmsPanel').style.display = 'block';
        initializeCMS();
      }
    });
  </script>
</body>
</html>
